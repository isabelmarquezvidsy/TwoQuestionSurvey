<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-F-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitment Application Survey</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom styles for better visual alignment and consistency */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensure inputs and textareas respect max-width */
        input[type="text"], textarea {
            max-width: 600px;
        }
        .placeholder-gray-500::placeholder {
            color: #808080;
        }
        /* Style for focused input/textarea */
        input:focus, textarea:focus {
            border-color: #fff !important; /* White border on focus */
            box-shadow: 0 0 0 1px #fff; /* White shadow on focus */
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // React application code starts here

        // Create a context for the user data and survey configuration
        const AppContext = React.createContext();

        // Helper function to generate a random date of birth (e.g., between 1980 and 2005)
        const getRandomDate = (startYear, endYear) => {
            const year = Math.floor(Math.random() * (endYear - startYear + 1)) + startYear;
            const month = Math.floor(Math.random() * 12) + 1;
            const day = Math.floor(Math.random() * 28) + 1; // Simplistic to avoid month-day issues
            return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        };

        // Function to generate 100 fictional users
        const generateFictionalUsers = () => {
            const users = [];
            const names = [
                "Alice", "Bob", "Charlie", "Diana", "Eve", "Frank", "Grace", "Heidi", "Ivan", "Judy",
                "Kevin", "Liam", "Mia", "Noah", "Olivia", "Peter", "Quinn", "Rachel", "Sam", "Tina",
                "Umar", "Vera", "Walter", "Xena", "Yara", "Zane", "Anna", "Ben", "Catherine", "David",
                "Emma", "Felix", "Georgia", "Harry", "Isabel", "Jack", "Karen", "Leo", "Megan", "Nathan",
                "Oscar", "Pamela", "Quentin", "Rebecca", "Steven", "Tara", "Ursula", "Victor", "Wendy", "Xavier",
                "Yvonne", "Zack", "Amber", "Brian", "Chloe", "Daniel", "Emily", "Finn", "Gabriella", "Henry",
                "Iris", "Jake", "Kim", "Louis", "Maria", "Nora", "Owen", "Penelope", "Ronan", "Sophia",
                "Thomas", "Uma", "Vincent", "Willow", "Zara", "Adam", "Bella", "Cody", "Daisy", "Ethan",
                "Faith", "Gavin", "Hannah", "Isaac", "Jasmine", "Kyle", "Lily", "Max", "Nina", "Oliver",
                "Paige", "Riley", "Sarah", "Tyler", "Violet", "Will", "Zara", "Aiden", "Brooke", "Caleb"
            ];
            const portfolios = [
                "https://www.creativeportfolio.com/user1", "https://www.artstation.com/user2",
                "https://www.behance.net/user3", "https://www.dribbble.com/user4",
                "https://www.flickr.com/user5", "https://www.instagram.com/user6",
                "https://www.unsplash.com/user7", "https://www.deviantart.com/user8",
                "https://www.vimeo.com/user9", "https://www.youtube.com/user10"
            ];

            // Corrected and expanded city-country mapping for factual accuracy
            const cityCountryMap = {
                "London": "UK",
                "New York": "USA",
                "Paris": "France",
                "Berlin": "Germany",
                "Tokyo": "Japan",
                "Sydney": "Australia",
                "Toronto": "Canada",
                "Madrid": "Spain",
                "Rome": "Italy",
                "Beijing": "China",
                "Los Angeles": "USA",
                "Manchester": "UK",
                "Lyon": "France",
                "Munich": "Germany",
                "Osaka": "Japan",
                "Melbourne": "Australia",
                "Vancouver": "Canada",
                "Barcelona": "Spain",
                "Milan": "Italy",
                "Shanghai": "China"
            };

            const cities = Object.keys(cityCountryMap);
            const genders = ["man", "woman", "non_binary", "prefer_not_to_say"];
            const languages = ["english", "french", "spanish", "german", "chinese", "japanese"];
            const origins = ["USA", "UK", "Canada", "France", "Germany", "Spain", "Japan", "China", "Australia", "Italy"];
            const ethnicities = ["White", "Black", "South_Asian", "East_and_SE_Asian", "Hispanic/Latin", "Middle_Eastern", "Pacific_Islander", "Other"];
            const hairTypes = ["wavy", "curly", "bald", "straight", "coily", "other"];
            const hairColours = ["black", "blond", "brunette", "brown", "red", "bald", "white_or_grey", "other"];
            const tattoosOptions = ["none", "yes_not_visible", "yes_visible_face_neck_shoulders"];
            const piercingsOptions = ["none", "yes_ear_piercing", "yes_not_visible", "yes_facial_piercings"];
            const coStarsOptions = ["dog", "cat", "other_pets", "baby", "kids_2_6", "kids_7_12", "teenagers", "couple", "friends", "parents", "none_of_the_above"];
            const filmingLocations = ["house", "apartment", "car", "garden", "podcast_setup", "gaming_setup", "gym_fitness_studio", "in_house_laundry", "home_office_study", "countryside", "city", "beach", "none_of_the_above"];

            // Funny invented address components
            const streetNumbers = ["42", "101", "7", "99", "666", "13"];
            const streetNames = ["Whispering Willow Way", "Giggle Grove", "Rainbow Road", "Starlight Street", "Dragonfly Drive", "Mystic Meadow Lane", "Unicorn Alley", "Pixel Place"];
            const streetTypes = ["Lane", "Road", "Avenue", "Street", "Boulevard", "Drive", "Place", "Circuit"];
            const fantasticalAreas = ["Cloud City", "Moonbeam Metropolis", "Enchanted Forest", "Quantum Quarters", "Singing Sands", "Lost Lagoon"];
            const zipCodes = ["90210", "50001", "ABCDE", "XY12Z"];

            for (let i = 0; i < 100; i++) {
                const randomCity = cities[Math.floor(Math.random() * cities.length)];
                const correspondingCountry = cityCountryMap[randomCity];

                // Determine number of languages based on the 50% split
                let numLanguages;
                if (i % 2 === 0) { // For roughly 50% of users (even indices)
                    numLanguages = Math.floor(Math.random() * 2) + 2; // 2 or 3 languages
                } else { // For the other 50% (odd indices)
                    numLanguages = Math.floor(Math.random() * 3) + 1; // 1, 2, or 3 languages
                }

                // Ensure unique languages are selected
                const selectedLanguages = new Set();
                while (selectedLanguages.size < numLanguages) {
                    selectedLanguages.add(languages[Math.floor(Math.random() * languages.length)]);
                }

                // Ensure at least 3 filming locations
                const userFilmingLocations = new Set();
                while (userFilmingLocations.size < 3 || (userFilmingLocations.size < filmingLocations.length && Math.random() < 0.5)) { // At least 3, and potentially more
                    userFilmingLocations.add(filmingLocations[Math.floor(Math.random() * filmingLocations.length)]);
                }

                // Ensure at least 3 co-stars
                const userCoStars = new Set();
                while (userCoStars.size < 3 || (userCoStars.size < coStarsOptions.length && Math.random() < 0.5)) { // At least 3, and potentially more
                    userCoStars.add(coStarsOptions[Math.floor(Math.random() * coStarsOptions.length)]);
                }


                const user = {
                    id: `user-${i + 1}`, // Add a simple ID
                    name: names[i % names.length] + ' ' + (i + 1), // Make names unique
                    portfolio: portfolios[Math.floor(Math.random() * portfolios.length)],
                    primary_work_location: [
                        randomCity,
                        correspondingCountry
                    ],
                    date_of_birth: getRandomDate(1980, 2005),
                    gender: genders[Math.floor(Math.random() * genders.length)],
                    languages_spoken_fluently: Array.from(selectedLanguages), // Use the unique selected languages
                    country_of_origin: origins[Math.floor(Math.random() * origins.length)],
                    ethnicity: ethnicities[Math.floor(Math.random() * ethnicities.length)],
                    co_stars: Array.from(userCoStars), // Assign generated co-stars
                    filming_location: Array.from(userFilmingLocations), // Assign generated filming locations
                    // New attribute: can_feature_small_business (approx. 1/3 'yes')
                    can_feature_small_business: (i % 3 === 0) ? "yes" : "no",
                };

                // Conditionally available fields (70% probability)
                if (Math.random() < 0.7) {
                    // Generate a funny invented address
                    const num = streetNumbers[Math.floor(Math.random() * streetNumbers.length)];
                    const street = streetNames[Math.floor(Math.random() * streetNames.length)];
                    const type = streetTypes[Math.floor(Math.random() * streetTypes.length)];
                    const area = fantasticalAreas[Math.floor(Math.random() * fantasticalAreas.length)];
                    const zip = zipCodes[Math.floor(Math.random() * zipCodes.length)];
                    user.Address = `${num} ${street} ${type}, ${area}, ${randomCity} ${zip}`; // Using city for consistency
                }
                if (Math.random() < 0.7) user.Mobile = `+1-${Math.floor(1000000000 + Math.random()*9000000000)}`;
                if (Math.random() < 0.7) user.hair_type = hairTypes[Math.floor(Math.random() * hairTypes.length)];
                if (Math.random() < 0.7) user.hair_colour = hairColours[Math.floor(Math.random() * hairColours.length)];
                if (Math.random() < 0.7) user.tattoos = tattoosOptions[Math.floor(Math.random() * tattoosOptions.length)];
                if (Math.random() < 0.7) user.piercings = piercingsOptions[Math.floor(Math.random() * piercingsOptions.length)];

                users.push(user);
            }
            return users;
        };

        // Function to get the display name for a question ID (moved to global scope)
        const getQuestionDisplayName = (id) => {
            switch (id) {
                case 'portfolio': return 'Portfolio';
                case 'primaryWorkLocation': return 'Primary work location';
                case 'address': return 'Address';
                case 'Mobile': return 'Phone number'; // Changed to Phone number as per visual
                case 'languages_spoken_fluently': return 'Spoken languages';
                case 'can_feature_small_business': return 'Can feature small business?'; // Added question mark for consistency
                case 'hair_type': return 'Hair type';
                case 'hair_colour': return 'Hair colour';
                case 'tattoos': return 'Tattoos';
                case 'piercings': return 'Piercings';
                case 'filmingLocation': return 'The filming location';
                case 'coStars': return 'Your co-stars';
                default: return id.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            }
        };

        // Backstage Component
        const Backstage = ({ setView }) => {
            const { surveyConfig, setSurveyConfig } = React.useContext(AppContext);
            const [projectTitle, setProjectTitle] = React.useState(surveyConfig.projectTitle);
            const [projectCode, setProjectCode] = React.useState(surveyConfig.projectCode);
            const [briefSummary, setBriefSummary] = React.useState(surveyConfig.briefSummary || ''); // New state for brief summary
            // selectedQuestions now stores objects { id: string, note: string, details: any }
            const [selectedQuestions, setSelectedQuestions] = React.useState(surveyConfig.selectedQuestions);
            const [message, setMessage] = React.useState('');
            const [showQuestionTypeMenu, setShowQuestionTypeMenu] = React.useState(false); // State for toggling the menu
            const [bespokeQuestions, setBespokeQuestions] = React.useState(surveyConfig.bespokeQuestions || []); // State for bespoke questions


            const allFilmingLocations = ["house", "apartment", "car", "garden", "podcast_setup", "gaming_setup", "gym_fitness_studio", "in_house_laundry", "home_office_study", "countryside", "city", "beach", "none_of_the_above"];
            const allCoStars = ["dog", "cat", "other_pets", "baby", "kids_2_6", "kids_7_12", "teenagers", "couple", "friends", "parents", "none_of_the_above"];


            // Update local state when surveyConfig from context changes
            React.useEffect(() => {
                setProjectTitle(surveyConfig.projectTitle);
                setProjectCode(surveyConfig.projectCode);
                setBriefSummary(surveyConfig.briefSummary || ''); // Update brief summary from context
                setSelectedQuestions(surveyConfig.selectedQuestions);
                setBespokeQuestions(surveyConfig.bespokeQuestions || []); // Update bespoke questions from context
            }, [surveyConfig]);


            const handleSaveSurvey = () => {
                const newConfig = {
                    projectTitle,
                    projectCode,
                    briefSummary, // Include brief summary in saved config
                    selectedQuestions,
                    bespokeQuestions // Include bespoke questions in saved config
                };
                setSurveyConfig(newConfig); // Update context
                setMessage('Application survey questions saved.'); // Set success message
                setTimeout(() => setMessage(''), 3000); // Clear message after 3 seconds
                // No persistence without Firebase
            };

            const handleQuestionChange = (e) => {
                const { value, checked } = e.target;

                // For 'filmingLocation' and 'coStars', the main checkbox only controls visibility of sub-options
                // and their presence in selectedQuestions is managed by chip clicks.
                // We still need to add/remove the parent if the checkbox is toggled directly.
                if (value === 'filmingLocation' || value === 'coStars') {
                    setSelectedQuestions(prev => {
                        if (checked) {
                            // If checked, ensure the parent question object exists in selectedQuestions
                            if (!prev.some(q => q.id === value)) {
                                return [...prev, { id: value, note: getQuestionNote(value), details: [] }];
                            }
                        } else {
                            // If unchecked, remove the parent question object
                            return prev.filter(q => q.id !== value);
                        }
                        return prev; // No change if already in desired state
                    });
                    return;
                }

                // For other questions, proceed as before
                const existingQuestion = selectedQuestions.find(q => q.id === value);
                if (checked) {
                    if (!existingQuestion) {
                        setSelectedQuestions(prev => [...prev, { id: value, note: '', details: [] }]);
                    }
                } else {
                    setSelectedQuestions(prev => prev.filter(q => q.id !== value));
                }
            };

            const handleNoteChange = (id, note) => {
                setSelectedQuestions(prev =>
                    prev.map(q => (q.id === id ? { ...q, note } : q))
                );
            };

            const handleFilmingLocationChipChange = (location) => {
                setSelectedQuestions(prevSelectedQuestions => {
                    let updatedQuestions = [...prevSelectedQuestions];
                    let filmingLocationQuestion = updatedQuestions.find(q => q.id === 'filmingLocation');

                    // If filmingLocationQuestion doesn't exist, create it.
                    if (!filmingLocationQuestion) {
                        filmingLocationQuestion = { id: 'filmingLocation', note: '', details: [] };
                        updatedQuestions.push(filmingLocationQuestion);
                    }

                    const currentDetails = filmingLocationQuestion.details || [];
                    const locationExists = currentDetails.some(detail => detail.name === location);

                    let newDetails;
                    if (locationExists) {
                        newDetails = currentDetails.filter(detail => detail.name !== location);
                    } else {
                        // Set askConfirmAccess and askForPhoto to true by default when a chip is selected
                        newDetails = [
                            ...currentDetails,
                            { name: location, askConfirmAccess: true, confirmAccessNote: '', askForPhoto: true, photoNote: '' }
                        ];
                    }

                    filmingLocationQuestion.details = newDetails;

                    // If no chips are selected AND the main checkbox is NOT checked, remove the parent question
                    const mainCheckboxChecked = document.querySelector(`input[type="checkbox"][value="filmingLocation"]`)?.checked; // Use optional chaining
                    if (newDetails.length === 0 && !mainCheckboxChecked) {
                        updatedQuestions = updatedQuestions.filter(q => q.id !== 'filmingLocation');
                    }

                    return updatedQuestions;
                });
            };

            const handleFilmingLocationSubQuestionChange = (locationName, subQuestionType, checked) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'filmingLocation') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === locationName) {
                                    return { ...detail, [subQuestionType]: checked };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleFilmingLocationSubNoteChange = (locationName, subNoteType, noteValue) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'filmingLocation') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === locationName) {
                                    return { ...detail, [subNoteType]: noteValue };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleCoStarChipChange = (coStar) => {
                setSelectedQuestions(prevSelectedQuestions => {
                    let updatedQuestions = [...prevSelectedQuestions];
                    let coStarsQuestion = updatedQuestions.find(q => q.id === 'coStars');

                    // If coStarsQuestion doesn't exist, create it.
                    if (!coStarsQuestion) {
                        coStarsQuestion = { id: 'coStars', note: '', details: [] };
                        updatedQuestions.push(coStarsQuestion);
                    }

                    const currentDetails = coStarsQuestion.details || [];
                    const coStarExists = currentDetails.some(detail => detail.name === coStar);

                    let newDetails;
                    if (coStarExists) {
                        newDetails = currentDetails.filter(detail => detail.name !== coStar);
                    } else {
                        // Set askConfirmAvailability and askForCastingPhoto to true by default when a chip is selected
                        newDetails = [
                            ...currentDetails,
                            { name: coStar, askConfirmAvailability: true, confirmAvailabilityNote: '', askForCastingPhoto: true, castingPhotoNote: '' }
                        ];
                    }

                    coStarsQuestion.details = newDetails;

                    // If no chips are selected AND the main checkbox is NOT checked, remove the parent question
                    const mainCheckboxChecked = document.querySelector(`input[type="checkbox"][value="coStars"]`)?.checked; // Use optional chaining
                    if (newDetails.length === 0 && !mainCheckboxChecked) {
                        updatedQuestions = updatedQuestions.filter(q => q.id !== 'coStars');
                    }

                    return updatedQuestions;
                });
            };

            const handleCoStarSubQuestionChange = (coStarName, subQuestionType, checked) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'coStars') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === coStarName) {
                                    return { ...detail, [subQuestionType]: checked };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleCoStarSubNoteChange = (coStarName, subNoteType, noteValue) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'coStars') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === coStarName) {
                                    return { ...detail, [subNoteType]: noteValue };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            // Calculate the count for display
            const calculateSelectedCount = () => {
                let count = 0;
                // Count selected questions from the main list
                selectedQuestions.forEach(q => {
                    if (q.id === 'filmingLocation' || q.id === 'coStars') {
                        count += (q.details ? q.details.length : 0);
                    } else {
                        count += 1;
                    }
                });
                return count;
            };

            // Calculate the count of selected items in the main "Creator data to validate" section
            const getBaseSelectedCount = () => {
                let baseCount = 0;
                selectedQuestions.forEach(q => {
                    if (q.id === 'filmingLocation' || q.id === 'coStars') {
                        baseCount += (q.details ? q.details.length : 0);
                    } else {
                        baseCount += 1;
                    }
                });
                return baseCount;
            };


            const isQuestionSelected = (id) => selectedQuestions.some(q => q.id === id);
            const getQuestionNote = (id) => selectedQuestions.find(q => q.id === id)?.note || '';
            const getFilmingLocationDetails = () => selectedQuestions.find(q => q.id === 'filmingLocation')?.details || [];
            const getCoStarDetails = () => selectedQuestions.find(q => q.id === 'coStars')?.details || [];

            const handleAddQuestionClick = () => {
                setShowQuestionTypeMenu(!showQuestionTypeMenu);
            };

            const handleSelectQuestionType = (type) => {
                setShowQuestionTypeMenu(false);
                setBespokeQuestions(prev => [
                    ...prev,
                    {
                        id: `bespoke-${Date.now()}`,
                        type: type,
                        questionText: '',
                        description: '',
                        required: false,
                        // Add a unique key for React rendering if needed, though id should suffice
                        key: Date.now()
                    }
                ]);
            };

            const handleBespokeQuestionTextChange = (id, field, value) => {
                setBespokeQuestions(prev =>
                    prev.map(q => {
                        if (q.id === id) {
                            let updatedQuestion = { ...q };

                            if (field === 'questionText') {
                                // Remove all existing asterisks from the value before processing
                                let cleanedValue = value.replace(/\*+$/, '');
                                updatedQuestion.questionText = cleanedValue;

                                // If the question is required, append a single asterisk
                                if (updatedQuestion.required) {
                                    updatedQuestion.questionText += '*';
                                }
                            } else {
                                updatedQuestion[field] = value; // For other fields, just update
                            }
                            return updatedQuestion;
                        }
                        return q;
                    })
                );
            };

            const handleBespokeQuestionToggleChange = (id, field, checked) => {
                setBespokeQuestions(prev =>
                    prev.map(q => {
                        if (q.id === id) {
                            let updatedQuestion = { ...q, [field]: checked };
                            if (field === 'required') {
                                // Clean the questionText from any existing asterisks first
                                let currentText = updatedQuestion.questionText.replace(/\*+/g, '');
                                if (checked) {
                                    updatedQuestion.questionText = currentText + '*'; // Add single asterisk if now required
                                } else {
                                    updatedQuestion.questionText = currentText; // Remove all asterisks if not required
                                }
                            }
                            return updatedQuestion;
                        }
                        return q;
                    })
                );
            };

            const handleRemoveBespokeQuestion = (id) => {
                setBespokeQuestions(prev => prev.filter(q => q.id !== id));
            };


            return (
                <div className="min-h-screen bg-[#17171A] flex justify-center py-10 px-4">
                    {/* Main form container - changed background to #17171A, added border-gray-800 */}
                    <div className="bg-[#17171A] p-8 rounded-lg shadow-xl w-full max-w-[800px] border border-gray-800">
                        <div className="flex justify-between items-center mb-10">
                            {/* Title - changed text color to white */}
                            <h1 className="text-3xl font-extrabold text-white">Internal's side</h1>
                            <button
                                onClick={() => setView('frontstage')}
                                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300 ease-in-out shadow-md"
                            >
                                View Creator UX (Answer Questions)
                            </button>
                        </div>

                        <br /><br /><br />

                        <div className="mb-6">
                            {/* Label - changed text color to gray-200 */}
                            <label htmlFor="projectTitle" className="block text-gray-200 text-base font-medium mb-1">Project Title</label>
                            {/* Input - changed background to #242429, border to gray-700, text to white */}
                            <input
                                type="text"
                                id="projectTitle"
                                value={projectTitle}
                                onChange={(e) => setProjectTitle(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 max-w-[600px] bg-[#242429] text-white"
                                placeholder=""
                            />
                        </div>

                        <div className="mb-6">
                            {/* Label - changed text color to gray-200 */}
                            <label htmlFor="projectCode" className="block text-gray-200 text-base font-medium mb-1">Project Code</label>
                            {/* Input - changed background to #242429, border to gray-700, text to white */}
                            <input
                                type="text"
                                id="projectCode"
                                value={projectCode}
                                onChange={(e) => setProjectCode(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 max-w-[600px] bg-[#242429] text-white"
                                placeholder=""
                            />
                        </div>

                        {/* New "Brief requirement summary" field */}
                        <div className="mb-10">
                            {/* Label - changed text color to gray-200 */}
                            <label htmlFor="briefSummary" className="block text-gray-200 text-base font-medium mb-1">Brief requirement summary</label>
                            {/* Textarea - changed background to #242429, border to gray-700, text to white */}
                            <textarea
                                id="briefSummary"
                                value={briefSummary}
                                onChange={(e) => setBriefSummary(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-700 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 resize-y min-h-[70px] max-w-[600px] bg-[#242429] text-white"
                                rows="3"
                                placeholder="ðŸ‡ºðŸ‡¸ New York-based.&#10;âœ¨ Age 25+, any gender.&#10;ðŸ‘€ No visible tattoos (OK if can be covered)."
                            ></textarea>
                        </div>

                        <div className="mb-8">
                            {/* Section title - changed text color to white and added counter */}
                            <h2 className="text-xl font-semibold text-white mb-4">Creator data to validate ({calculateSelectedCount()})</h2>
                            {/* Description text - changed text color to gray-400 */}
                            <p className="text-gray-400 text-sm mb-6">
                                Creators have already shared this information with us. Please tick the data you'd like them to confirm if it's still appropriate for this brief.
                            </p>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">

                                {/* Portfolio Question */}
                                <div className="mb-2">
                                    {/* Label - changed text color to gray-200 */}
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="portfolio"
                                            checked={isQuestionSelected('portfolio')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Portfolio</span>
                                    </label>
                                </div>

                                {/* Primary Work Location Question */}
                                <div className="mb-2">
                                    {/* Label - changed text color to gray-200 */}
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="primaryWorkLocation"
                                            checked={isQuestionSelected('primaryWorkLocation')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Primary Work Location</span>
                                    </label>
                                </div>

                                {/* Small Business Question */}
                                <div className="mb-2">
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="can_feature_small_business"
                                            checked={isQuestionSelected('can_feature_small_business')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Small Business</span>
                                    </label>
                                </div>

                                {/* Address Question */}
                                <div className="mb-2">
                                    {/* Label - changed text color to gray-200 */}
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="address"
                                            checked={isQuestionSelected('address')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Address</span>
                                    </label>
                                </div>

                                {/* Mobile Question */}
                                <div className="mb-2">
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="Mobile"
                                            checked={isQuestionSelected('Mobile')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Mobile</span>
                                    </label>
                                </div>

                                {/* Spoken Languages Question */}
                                <div className="mb-2">
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="languages_spoken_fluently"
                                            checked={isQuestionSelected('languages_spoken_fluently')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Spoken languages</span>
                                    </label>
                                </div>

                                {/* Hair Type Question */}
                                <div className="mb-2">
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="hair_type"
                                            checked={isQuestionSelected('hair_type')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Hair type</span>
                                    </label>
                                </div>

                                {/* Hair Colour Question */}
                                <div className="mb-2">
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="hair_colour"
                                            checked={isQuestionSelected('hair_colour')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Hair colour</span>
                                    </label>
                                </div>

                                {/* Tattoos Question */}
                                <div className="mb-2">
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="tattoos"
                                            checked={isQuestionSelected('tattoos')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Tattoos</span>
                                    </label>
                                </div>

                                {/* Piercings Question */}
                                <div className="mb-2">
                                    <label className="flex items-center text-gray-200 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            value="piercings"
                                            checked={isQuestionSelected('piercings')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Piercings</span>
                                    </label>
                                </div>
                            </div> {/* End of grid for individual fields */}

                            {/* Filming Location Question */}
                            <div className="mt-8 mb-6 col-span-full"> {/* Added mt-8 for extra space */}
                                {/* Label - changed text color to gray-200 */}
                                <label className="flex items-center text-gray-200 cursor-pointer mb-2">
                                    <input
                                        type="checkbox"
                                        value="filmingLocation"
                                        checked={isQuestionSelected('filmingLocation')}
                                        onChange={handleQuestionChange}
                                        className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                    />
                                    <span className="ml-3 text-lg font-medium">Filming location needed for this brief</span>
                                </label>
                                <div className="ml-8 mt-2 flex flex-wrap gap-2"> {/* Reduced mt to 2 */}
                                    {allFilmingLocations.map(location => {
                                        const locationDetail = getFilmingLocationDetails().find(d => d.name === location);
                                        const isLocationSelected = !!locationDetail;

                                        return (
                                            <React.Fragment key={location}>
                                                <button
                                                    type="button"
                                                    onClick={() => handleFilmingLocationChipChange(location)}
                                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200
                                                        ${isLocationSelected
                                                            ? 'bg-blue-600 text-white shadow-md'
                                                            : 'bg-gray-700 text-gray-200 hover:bg-gray-600'
                                                        }`}
                                                >
                                                    {location.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                </button>
                                            </React.Fragment>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* New Co-stars Question */}
                            <div className="mt-8 mb-6 col-span-full"> {/* Added mt-8 for extra space */}
                                {/* Label - changed text color to gray-200 */}
                                <label className="flex items-center text-gray-200 cursor-pointer mb-2">
                                    <input
                                        type="checkbox"
                                        value="coStars"
                                        checked={isQuestionSelected('coStars')}
                                        onChange={handleQuestionChange}
                                        className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                    />
                                    <span className="ml-3 text-lg font-medium">Co-stars needed for this brief</span>
                                </label>
                                <div className="ml-8 mt-2 flex flex-wrap gap-2"> {/* Reduced mt to 2 */}
                                    {allCoStars.map(coStar => {
                                        const coStarDetail = getCoStarDetails().find(d => d.name === coStar);
                                        const isCoStarSelected = !!coStarDetail;

                                        return (
                                            <React.Fragment key={coStar}>
                                                <button
                                                    type="button"
                                                    onClick={() => handleCoStarChipChange(coStar)}
                                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200
                                                        ${isCoStarSelected
                                                            ? 'bg-blue-600 text-white shadow-md'
                                                            : 'bg-gray-700 text-gray-200 hover:bg-gray-600'
                                                        }`}
                                                >
                                                    {coStar.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                </button>
                                            </React.Fragment>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* Additional Bespoke Questions Section */}
                            <div className="mt-[100px] w-full"> {/* 100px gap */}
                                <h2 className="text-xl font-semibold text-white mb-4">Additional bespoke questions</h2>
                                {/* Render Bespoke Questions */}
                                {bespokeQuestions.map((q, index) => (
                                    <React.Fragment key={q.id}> {/* Use React.Fragment here */}
                                        <div className="mt-8 p-6 rounded-lg shadow-md bg-[#242429] border border-gray-800">
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-lg font-semibold text-white">
                                                    {getBaseSelectedCount() + index + 1} {/* Corrected numbering */}
                                                </h3>
                                                <button onClick={() => handleRemoveBespokeQuestion(q.id)} className="text-gray-400 hover:text-white transition-colors duration-200">
                                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
                                                    </svg>
                                                </button>
                                            </div>

                                            {q.type === 'text_answer' && (
                                                <React.Fragment>
                                                    <label htmlFor={`textAnswer-${q.id}`} className="block text-gray-200 text-base font-medium mb-1">Text answer</label>
                                                    <input
                                                        type="text"
                                                        id={`textAnswer-${q.id}`}
                                                        value={q.questionText}
                                                        onFocus={(e) => e.target.classList.add('border-white', 'ring-1', 'ring-white')}
                                                        onBlur={(e) => e.target.classList.remove('border-white', 'ring-1', 'ring-white')}
                                                        onChange={(e) => handleBespokeQuestionTextChange(q.id, 'questionText', e.target.value)}
                                                        className="w-full px-3 py-2 border border-gray-700 rounded-md focus:outline-none max-w-[600px] bg-[#303036] text-white"
                                                        placeholder="Type your question here"
                                                    />
                                                    <label htmlFor={`description-${q.id}`} className="block text-gray-200 text-base font-medium mb-1 mt-4">Description (optional)</label>
                                                    <textarea
                                                        id={`description-${q.id}`}
                                                        value={q.description}
                                                        onFocus={(e) => e.target.classList.add('border-white', 'ring-1', 'ring-white')}
                                                        onBlur={(e) => e.target.classList.remove('border-white', 'ring-1', 'ring-white')}
                                                        onChange={(e) => handleBespokeQuestionTextChange(q.id, 'description', e.target.value)}
                                                        className="w-full px-3 py-2 border border-gray-700 rounded-md text-sm focus:outline-none resize-none min-h-[38px] max-w-[600px] bg-[#303036] text-white" /* Changed rows to 1 and min-h to 38px */
                                                        rows="1"
                                                    ></textarea>
                                                    <div className="flex items-center mt-4">
                                                        <span className="text-gray-200 mr-3">Required</span>
                                                        <label htmlFor={`required-${q.id}`} className="relative inline-flex items-center cursor-pointer">
                                                            <input
                                                                type="checkbox"
                                                                id={`required-${q.id}`}
                                                                checked={q.required}
                                                                onChange={(e) => handleBespokeQuestionToggleChange(q.id, 'required', e.target.checked)}
                                                                className="sr-only peer"
                                                            />
                                                            <div className="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                        </label>
                                                        <button className="ml-auto text-blue-400 hover:text-blue-300 transition-colors duration-200">
                                                            Add a picture or link
                                                        </button>
                                                    </div>
                                                </React.Fragment>
                                            )}

                                            {q.type === 'upload_photo' && (
                                                <React.Fragment>
                                                    <label htmlFor={`photoQuestion-${q.id}`} className="block text-gray-200 text-base font-medium mb-1">Photo upload</label> {/* Changed label here */}
                                                    <input
                                                        type="text"
                                                        id={`photoQuestion-${q.id}`}
                                                        value={q.questionText}
                                                        onFocus={(e) => e.target.classList.add('border-white', 'ring-1', 'ring-white')}
                                                        onBlur={(e) => e.target.classList.remove('border-white', 'ring-1', 'ring-white')}
                                                        onChange={(e) => handleBespokeQuestionTextChange(q.id, 'questionText', e.target.value)}
                                                        className="w-full px-3 py-2 border border-gray-700 rounded-md focus:outline-none max-w-[600px] bg-[#303036] text-white"
                                                        placeholder="Type your photo question here"
                                                    />
                                                    <label htmlFor={`photoDescription-${q.id}`} className="block text-gray-200 text-base font-medium mb-1 mt-4">Description (optional)</label>
                                                    <textarea
                                                        id={`photoDescription-${q.id}`}
                                                        value={q.description}
                                                        onFocus={(e) => e.target.classList.add('border-white', 'ring-1', 'ring-white')}
                                                        onBlur={(e) => e.target.classList.remove('border-white', 'ring-1', 'ring-white')}
                                                        onChange={(e) => handleBespokeQuestionTextChange(q.id, 'description', e.target.value)}
                                                        className="w-full px-3 py-2 border border-gray-700 rounded-md text-sm focus:outline-none resize-none min-h-[38px] max-w-[600px] bg-[#303036] text-white" /* Changed rows to 1 and min-h to 38px */
                                                        rows="1"
                                                    ></textarea>
                                                    <div className="flex items-center mt-4">
                                                        <span className="text-gray-200 mr-3">Required</span>
                                                        <label htmlFor={`photoRequired-${q.id}`} className="relative inline-flex items-center cursor-pointer">
                                                            <input
                                                                type="checkbox"
                                                                id={`photoRequired-${q.id}`}
                                                                checked={q.required}
                                                                onChange={(e) => handleBespokeQuestionToggleChange(q.id, 'required', e.target.checked)}
                                                                className="sr-only peer"
                                                            />
                                                            <div className="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                        </label>
                                                    </div>
                                                    {/* Greyed out, non-interactable box */}
                                                    <div className="mt-4 p-4 border border-gray-700 rounded-md flex flex-col items-center justify-center bg-[#303036] opacity-50 cursor-not-allowed">
                                                        <svg className="w-10 h-10 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                        </svg>
                                                        <span className="text-gray-400 text-sm">Choose file</span>
                                                        <span className="text-gray-500 text-xs mt-1">Size limit: 10MB</span>
                                                    </div>
                                                </React.Fragment>
                                            )}
                                        </div>
                                    </React.Fragment>
                                ))}
                                {/* This "Add a question" divider will appear below all dynamically added questions */}
                                <div className="relative flex items-center justify-center w-full mt-8">
                                    <div className={`flex-grow h-px ${showQuestionTypeMenu ? 'bg-white' : 'bg-gray-700'} transition-colors duration-300`}></div>
                                    <button
                                        type="button"
                                        onClick={handleAddQuestionClick}
                                        className={`flex items-center px-4 py-2 rounded-full border ${showQuestionTypeMenu ? 'border-white text-white' : 'border-gray-700 text-gray-400'} transition-colors duration-300 hover:border-white hover:text-white mx-4`}
                                    >
                                        <svg className={`w-5 h-5 mr-2 ${showQuestionTypeMenu ? 'text-white' : 'text-gray-400'} transition-colors duration-300`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        Add a question
                                    </button>
                                    <div className={`flex-grow h-px ${showQuestionTypeMenu ? 'bg-white' : 'bg-gray-700'} transition-colors duration-300`}></div>
                                </div>

                                {showQuestionTypeMenu && (
                                    <div className="absolute left-1/2 transform -translate-x-1/2 mt-4 bg-[#242429] border border-gray-700 rounded-md shadow-lg z-10 w-full max-w-xs">
                                        <button
                                            type="button"
                                            onClick={() => handleSelectQuestionType('text_answer')}
                                            className="flex items-center w-full px-4 py-3 text-left text-gray-200 hover:bg-gray-700 rounded-t-md transition-colors duration-200"
                                        >
                                            <svg className="w-5 h-5 mr-3 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            Text Answer
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => handleSelectQuestionType('upload_photo')}
                                            className="flex items-center w-full px-4 py-3 text-left text-gray-200 hover:bg-gray-700 rounded-b-md transition-colors duration-200"
                                        >
                                            <svg className="w-5 h-5 mr-3 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                            Upload photo
                                        </button>
                                    </div>
                                )}
                            </div>


                        </div>

                        <button
                            onClick={handleSaveSurvey}
                            className="w-full py-3 bg-green-600 text-white font-bold rounded-md hover:bg-green-600 transition duration-300 ease-in-out shadow-lg transform hover:scale-105 mt-[250px]"
                        >
                            Save Survey Configuration
                        </button>
                        {message && (
                            <p className="text-center text-green-400 text-sm mt-2">{message}</p>
                        )}
                    </div>
                </div>
            );
        };

        // Frontstage Component
        const Frontstage = ({ setView }) => {
            const { users, surveyConfig } = React.useContext(AppContext);
            const [userName, setUserName] = React.useState('');
            const [currentUser, setCurrentUser] = React.useState(null);
            const [message, setMessage] = React.useState('');
            const [bespokeAnswers, setBespokeAnswers] = React.useState({}); // State to store answers for bespoke questions


            // State for Portfolio
            const [portfolioValue, setPortfolioValue] = React.useState('');
            const [originalPortfolio, setOriginalPortfolio] = React.useState('');
            const [replacePortfolio, setReplacePortfolio] = React.useState(false);

            // State for Primary Work Location
            const [locationDecision, setLocationDecision] = React.useState('');
            const [newLocation, setNewLocation] = React.useState('');
            const [replaceLocation, setReplaceLocation] = React.useState(false);

            // State for Address
            const [addressValue, setAddressValue] = React.useState('');
            const [originalAddress, setOriginalAddress] = React.useState('');
            const [replaceAddress, setReplaceAddress] = React.useState(false);

            // State for Filming Location
            const [filmingLocationDecision, setFilmingLocationDecision] = React.useState('');
            const [filmingLocationResponses, setFilmingLocationResponses] = React.useState({});

            // State for Co-stars
            const [coStarDecision, setCoStarDecision] = React.useState('');
            const [coStarResponses, setCoStarResponses] = React.useState({});

            // State for Mobile
            const [mobileValue, setMobileValue] = React.useState('');
            const [replaceMobile, setReplaceMobile] = React.useState(false);
            const [originalMobile, setOriginalMobile] = React.useState('');

            // State for Spoken Languages
            const [languagesValue, setLanguagesValue] = React.useState([]);
            const [originalLanguages, setOriginalLanguages] = React.useState([]);
            const [replaceLanguages, setReplaceLanguages] = React.useState(false);
            const allLanguagesOptions = ["english", "french", "spanish", "german", "chinese", "japanese"];

            // State for Small Business
            const [smallBusinessDecision, setSmallBusinessDecision] = React.useState('');
            const [replaceSmallBusiness, setReplaceSmallBusiness] = React.useState(false);

            // State for Hair Type
            const [hairTypeValue, setHairTypeValue] = React.useState('');
            const [originalHairType, setOriginalHairType] = React.useState('');
            const [replaceHairType, setReplaceHairType] = React.useState(false);
            const hairTypeOptions = ["wavy", "curly", "bald", "straight", "coily", "other"];

            // State for Hair Colour
            const [hairColourValue, setHairColourValue] = React.useState('');
            const [originalHairColour, setOriginalHairColour] = React.useState('');
            const [replaceHairColour, setReplaceHairColour] = React.useState(false);
            const hairColourOptions = ["black", "blond", "brunette", "brown", "red", "bald", "white_or_grey", "other"];

            // State for Tattoos
            const [tattoosValue, setTattoosValue] = React.useState('');
            const [originalTattoos, setOriginalTattoos] = React.useState('');
            const [replaceTattoos, setReplaceTattoos] = React.useState(false);
            const tattoosOptions = ["none", "yes_not_visible", "yes_visible_face_neck_shoulders"];

            // State for Piercings
            const [piercingsValue, setPiercingsValue] = React.useState('');
            const [originalPiercings, setOriginalPiercings] = React.useState('');
            const [replacePiercings, setReplacePiercings] = React.useState(false);
            const piercingsOptions = ["none", "yes_ear_piercing", "yes_not_visible", "yes_facial_piercings"];


            // Effect to initialize values when currentUser changes
            React.useEffect(() => {
                if (currentUser) {
                    setPortfolioValue(currentUser.portfolio || '');
                    setOriginalPortfolio(currentUser.portfolio || '');
                    setReplacePortfolio(false);

                    setAddressValue(currentUser.Address || '');
                    setOriginalAddress(currentUser.Address || '');
                    setReplaceAddress(false);

                    setMobileValue(currentUser.Mobile || '');
                    setOriginalMobile(currentUser.Mobile || '');
                    setReplaceMobile(false);

                    setLanguagesValue(currentUser.languages_spoken_fluently || []);
                    setOriginalLanguages(currentUser.languages_spoken_fluently || []);
                    setReplaceLanguages(false);

                    setHairTypeValue(currentUser.hair_type || '');
                    setOriginalHairType(currentUser.hair_type || '');
                    setReplaceHairType(false);

                    setHairColourValue(currentUser.hair_colour || '');
                    setOriginalHairColour(currentUser.hair_colour || '');
                    setReplaceHairColour(false);

                    setTattoosValue(currentUser.tattoos || '');
                    setOriginalTattoos(currentUser.tattoos || '');
                    setReplaceTattoos(false);

                    setPiercingsValue(currentUser.piercings || '');
                    setOriginalPiercings(currentUser.piercings || '');
                    setReplacePiercings(false);

                    // Initialize bespoke answers when user changes
                    const initialBespokeAnswers = {};
                    surveyConfig.bespokeQuestions.forEach(q => {
                        initialBespokeAnswers[q.id] = { answer: '', file: null };
                    });
                    setBespokeAnswers(initialBespokeAnswers);
                }
            }, [currentUser, surveyConfig.bespokeQuestions]);


            const handleFindUser = () => {
                const foundUser = users.find(user => user.name.toLowerCase() === userName.toLowerCase());
                if (foundUser) {
                    setCurrentUser(foundUser);
                    setMessage('');
                    // Reset all states for dynamic inputs
                    setPortfolioValue(foundUser.portfolio || '');
                    setOriginalPortfolio(foundUser.portfolio || '');
                    setReplacePortfolio(false);

                    setLocationDecision(''); setNewLocation(''); setReplaceLocation(false);

                    setAddressValue(foundUser.Address || '');
                    setOriginalAddress(foundUser.Address || '');
                    setReplaceAddress(false);

                    setFilmingLocationDecision(''); setFilmingLocationResponses({});
                    setCoStarDecision(''); setCoStarResponses({});

                    setMobileValue(foundUser.Mobile || '');
                    setOriginalMobile(foundUser.Mobile || '');
                    setReplaceMobile(false);

                    setLanguagesValue(foundUser.languages_spoken_fluently || []);
                    setOriginalLanguages(foundUser.languages_spoken_fluently || []);
                    setReplaceLanguages(false);

                    setSmallBusinessDecision(''); setReplaceSmallBusiness(false);

                    setHairTypeValue(foundUser.hair_type || '');
                    setOriginalHairType(foundUser.hair_type || '');
                    setReplaceHairType(false);

                    setHairColourValue(foundUser.hair_colour || '');
                    setOriginalHairColour(foundUser.hair_colour || '');
                    setReplaceHairColour(false);

                    setTattoosValue(foundUser.tattoos || '');
                    setOriginalTattoos(foundUser.tattoos || '');
                    setReplaceTattoos(false);

                    setPiercingsValue(foundUser.piercings || '');
                    setOriginalPiercings(foundUser.piercings || '');
                    setReplacePiercings(false);

                    // Re-initialize bespoke answers when a new user is found
                    const initialBespokeAnswers = {};
                    surveyConfig.bespokeQuestions.forEach(q => {
                        initialBespokeAnswers[q.id] = { answer: '', file: null };
                    });
                    setBespokeAnswers(initialBespokeAnswers);

                } else {
                    setCurrentUser(null);
                    setMessage('User not found. Please check the name and try again.');
                }
            };

            const renderField = (label, value) => {
                if (value === undefined || value === null || (Array.isArray(value) && value.length === 0)) {
                    return null;
                }
                return (
                    <div className="mb-2">
                        <span className="font-semibold text-gray-700">{label}:</span>
                        <span className="ml-2 text-gray-900">{Array.isArray(value) ? value.join(', ') : value}</span>
                    </div>
                );
            };

            const getQuestionConfig = (id) => surveyConfig.selectedQuestions.find(q => q.id === id);

            const handleFilmingLocationUserResponse = (locationName, field, value) => {
                setFilmingLocationResponses(prev => ({
                    ...prev,
                    [locationName]: {
                        ...prev[locationName],
                        [field]: value
                    }
                }));
            };

            const handleCoStarUserResponse = (coStarName, field, value) => {
                setCoStarResponses(prev => ({
                    ...prev,
                    [coStarName]: {
                        ...prev[coStarName],
                        [field]: value
                    }
                }));
            };

            const handleBespokeAnswerChange = (questionId, value) => {
                setBespokeAnswers(prev => ({
                    ...prev,
                    [questionId]: { ...prev[questionId], answer: value }
                }));
            };

            const handleBespokeFileChange = (questionId, file) => {
                setBespokeAnswers(prev => ({
                    ...prev,
                    [questionId]: { ...prev[questionId], file: file }
                }));
            };

            const handleLanguageAdd = (e) => {
                const newLang = e.target.value;
                if (newLang && !languagesValue.includes(newLang)) {
                    const updatedLanguages = [...languagesValue, newLang];
                    setLanguagesValue(updatedLanguages);
                    setReplaceLanguages(JSON.stringify(updatedLanguages.sort()) !== JSON.stringify(originalLanguages.sort()));
                }
                e.target.value = ''; // Reset dropdown
            };

            const handleLanguageRemove = (langToRemove) => {
                const updatedLanguages = languagesValue.filter(lang => lang !== langToRemove);
                setLanguagesValue(updatedLanguages);
                setReplaceLanguages(JSON.stringify(updatedLanguages.sort()) !== JSON.stringify(originalLanguages.sort()));
            };

            // Consolidated list of all questions for rendering and numbering on Creator side
            const allDisplayQuestions = [];

            // Predefined question IDs in their desired display order
            const predefinedQuestionOrder = [
                'portfolio', 'can_feature_small_business', 'Mobile', 'languages_spoken_fluently',
                'hair_type', 'hair_colour', 'tattoos', 'piercings', 'address', // Address moved for logical flow
                'filmingLocation', 'coStars'
            ];

            // Add selected predefined questions
            predefinedQuestionOrder.forEach(id => {
                const selectedQ = surveyConfig.selectedQuestions.find(q => q.id === id);
                if (selectedQ) {
                    // Handle special cases for filmingLocation and coStars which have sub-details
                    if (id === 'filmingLocation' || id === 'coStars') {
                        if (selectedQ.details && selectedQ.details.length > 0) {
                            selectedQ.details.forEach(detail => {
                                allDisplayQuestions.push({
                                    type: id, // Original type (filmingLocation or coStars)
                                    id: `${id}-${detail.name}`, // Unique ID for React key
                                    questionText: `${getQuestionDisplayName(id)}: ${detail.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}`,
                                    description: selectedQ.note,
                                    isChip: true,
                                    originalParent: selectedQ // Reference to the parent selected question
                                });
                            });
                        }
                    } else {
                        // For other predefined questions
                        allDisplayQuestions.push({
                            type: id, // Original type (e.g., portfolio, Mobile)
                            id: id,
                            questionText: getQuestionDisplayName(id),
                            description: selectedQ.note
                        });
                    }
                }
            });

            // Add bespoke questions
            surveyConfig.bespokeQuestions.forEach(q => {
                allDisplayQuestions.push({
                    type: q.type,
                    id: q.id,
                    questionText: q.questionText,
                    description: q.description,
                    required: q.required,
                    isBespoke: true
                });
            });


            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex justify-center py-10 px-4">
                    <div className="bg-white p-8 rounded-xl shadow-2xl w-full max-w-[800px] border-t-4 border-blue-500">
                        <React.Fragment>
                            <div className="flex justify-between items-center mb-10">
                                <h1 className="text-4xl font-extrabold text-gray-900">Creator's side</h1>
                                <button
                                    onClick={() => setView('backstage')}
                                    className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-300 ease-in-out shadow-md"
                                >
                                    View Internal/Community UX (Create Questions)
                                </button>
                            </div>

                            <br /><br /><br />

                            <div className="mb-8">
                                <label htmlFor="userName" className="block text-gray-800 text-lg font-bold mb-3">Enter Your Name to Begin:</label>
                                <div className="flex space-x-3">
                                    <input
                                        type="text"
                                        id="userName"
                                        value={userName}
                                        onChange={(e) => setUserName(e.target.value)}
                                        className="flex-grow px-5 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500 text-lg max-w-[600px]"
                                        placeholder="e.g., Alice 1"
                                    />
                                    <button
                                        onClick={handleFindUser}
                                        className="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-lg transform hover:scale-105"
                                >
                                        Find My Profile
                                    </button>
                                </div>
                                {message && <p className="mt-4 text-center text-sm font-medium text-red-600">{message}</p>}
                            </div>

                            {currentUser && (
                                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200 shadow-inner">
                                    <h2 className="2xl font-bold text-gray-800 mb-4">
                                        Hello {currentUser.name}!
                                        {surveyConfig.projectTitle && ` So pleased to see you're interested in ${surveyConfig.projectTitle}.`}
                                    </h2>

                                    <p className="text-base font-normal text-gray-700 mb-6">Before we can proceed, please answer the following questions.</p>


                                    {(allDisplayQuestions.length > 0) ? (
                                        <React.Fragment>
                                            {allDisplayQuestions.map((q, index) => (
                                                <div key={q.id} className="mb-8 px-6 py-5 border border-gray-200 rounded-md bg-white shadow-sm">
                                                    <h3 className="text-xl font-semibold text-gray-800 mb-4">
                                                        {index + 1}. {q.questionText}
                                                    </h3>
                                                    {q.description && (
                                                        <p className="text-gray-700 text-sm mb-4">{q.description}</p>
                                                    )}

                                                    {q.type === 'portfolio' && (
                                                        <React.Fragment>
                                                            <label htmlFor="portfolioInput" className="block text-gray-700 text-base font-medium mb-1">Portfolio Link</label>
                                                            <input
                                                                type="text"
                                                                id="portfolioInput"
                                                                value={portfolioValue}
                                                                onChange={(e) => {
                                                                    setPortfolioValue(e.target.value);
                                                                    setReplacePortfolio(e.target.value !== (originalPortfolio || ''));
                                                                }}
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!portfolioValue && !originalPortfolio ? 'placeholder-gray-500' : ''}`}
                                                                placeholder="Enter portfolio link"
                                                            />
                                                            {replacePortfolio && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replacePortfolio}
                                                                        onChange={(e) => setReplacePortfolio(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{originalPortfolio ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'primaryWorkLocation' && (
                                                        <React.Fragment>
                                                            {q.note && (
                                                                <p className="text-gray-500 text-sm italic mb-1">
                                                                    "{q.note}"
                                                                </p>
                                                            )}
                                                            <p className="text-gray-700 mb-2">We have your location down as <span className="font-medium text-blue-700">{currentUser.primary_work_location[0]} in {currentUser.primary_work_location[1]}</span></p>
                                                            <p className="text-gray-700 mb-4">Is this current?</p>
                                                            <div className="flex items-center space-x-6 mb-4">
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name="locationDecision"
                                                                        value="yes"
                                                                        checked={locationDecision === 'yes'}
                                                                        onChange={() => { setLocationDecision('yes'); setNewLocation(''); setReplaceLocation(false); }}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">Yes</span>
                                                                </label>
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name="locationDecision"
                                                                        value="no"
                                                                        checked={locationDecision === 'no'}
                                                                        onChange={() => setLocationDecision('no')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">No</span>
                                                                </label>
                                                            </div>

                                                            {locationDecision === 'no' && (
                                                                <div className="mt-4">
                                                                    <input
                                                                        type="text"
                                                                        value={newLocation}
                                                                        onChange={(e) => setNewLocation(e.target.value)}
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px]"
                                                                        placeholder="Enter your work location for this brief"
                                                                    />
                                                                    <label className="flex items-center text-gray-700 mt-3">
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={replaceLocation}
                                                                            onChange={(e) => setReplaceLocation(e.target.checked)}
                                                                            className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                        <span className="ml-2">Replace what's on my profile</span>
                                                                    </label>
                                                                </div>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'can_feature_small_business' && (
                                                        <React.Fragment>
                                                            <label htmlFor="smallBusinessDecisionYes" className="block text-gray-700 text-base font-medium mb-1">Can feature small business?</label>
                                                            <div className="flex items-center space-x-6 mb-4">
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name="smallBusinessDecision"
                                                                        id="smallBusinessDecisionYes"
                                                                        value="yes"
                                                                        checked={smallBusinessDecision === 'yes' || (smallBusinessDecision === '' && currentUser.can_feature_small_business === 'yes')}
                                                                        onChange={(e) => {
                                                                            setSmallBusinessDecision(e.target.value);
                                                                            setReplaceSmallBusiness(e.target.value !== currentUser.can_feature_small_business);
                                                                        }}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">Yes</span>
                                                                </label>
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name="smallBusinessDecision"
                                                                        id="smallBusinessDecisionNo"
                                                                        value="no"
                                                                        checked={smallBusinessDecision === 'no' || (smallBusinessDecision === '' && currentUser.can_feature_small_business === 'no')}
                                                                        onChange={(e) => {
                                                                            setSmallBusinessDecision(e.target.value);
                                                                            setReplaceSmallBusiness(e.target.value !== currentUser.can_feature_small_business);
                                                                        }}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">No</span>
                                                                </label>
                                                            </div>
                                                            {replaceSmallBusiness && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replaceSmallBusiness}
                                                                        onChange={(e) => setReplaceSmallBusiness(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{currentUser.can_feature_small_business ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'address' && (
                                                        <React.Fragment>
                                                            <label htmlFor="addressInput" className="block text-gray-700 text-base font-medium mb-1">Address</label>
                                                            <input
                                                                type="text"
                                                                id="addressInput"
                                                                value={addressValue}
                                                                onChange={(e) => {
                                                                    setAddressValue(e.target.value);
                                                                    setReplaceAddress(e.target.value !== (originalAddress || ''));
                                                                }}
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!addressValue && !originalAddress ? 'placeholder-gray-500' : ''}`}
                                                                placeholder="Enter your address"
                                                            />
                                                            {replaceAddress && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replaceAddress}
                                                                        onChange={(e) => setReplaceAddress(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{originalAddress ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'Mobile' && (
                                                        <React.Fragment>
                                                            <label htmlFor="mobileInput" className="block text-gray-700 text-base font-medium mb-1">Mobile number</label>
                                                            <input
                                                                type="text"
                                                                id="mobileInput"
                                                                value={mobileValue}
                                                                onChange={(e) => {
                                                                    setMobileValue(e.target.value);
                                                                    // Show checkbox if current value is different from original
                                                                    setReplaceMobile(e.target.value !== (originalMobile || ''));
                                                                }}
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!mobileValue && !originalMobile ? 'placeholder-gray-500' : ''}`}
                                                                placeholder="Mobile/cell number (include country code)"
                                                            />
                                                            {replaceMobile && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replaceMobile}
                                                                        onChange={(e) => setReplaceMobile(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{originalMobile ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'languages_spoken_fluently' && (
                                                        <React.Fragment>
                                                            <label htmlFor="languagesInput" className="block text-gray-700 text-base font-medium mb-1">Spoken languages</label>
                                                            <div className="flex flex-wrap gap-2 mb-2">
                                                                {languagesValue.map(lang => (
                                                                    <span key={lang} className="flex items-center bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full">
                                                                        {lang.replace(/\b\w/g, l => l.toUpperCase())}
                                                                        <button
                                                                            type="button"
                                                                            onClick={() => handleLanguageRemove(lang)}
                                                                            className="ml-1.5 text-blue-800 hover:text-blue-600 focus:outline-none"
                                                                        >
                                                                            <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
                                                                            </svg>
                                                                        </button>
                                                                    </span>
                                                                ))}
                                                            </div>
                                                            <select
                                                                id="languagesInput"
                                                                onChange={handleLanguageAdd}
                                                                value="" // Controlled component, reset value after selection
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!languagesValue.length ? 'text-gray-500' : ''}`}
                                                            >
                                                                <option value="" disabled>Add a language</option>
                                                                {allLanguagesOptions.map(option => (
                                                                    <option
                                                                        key={option}
                                                                        value={option}
                                                                        disabled={languagesValue.includes(option)}
                                                                        className={languagesValue.includes(option) ? 'text-gray-400' : ''}
                                                                    >
                                                                        {option.replace(/\b\w/g, l => l.toUpperCase())}
                                                                    </option>
                                                                ))}
                                                            </select>
                                                            {replaceLanguages && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replaceLanguages}
                                                                        onChange={(e) => setReplaceLanguages(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{JSON.stringify(originalLanguages.sort()) !== JSON.stringify([].sort()) ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'hair_type' && (
                                                        <React.Fragment>
                                                            <label htmlFor="hairTypeInput" className="block text-gray-700 text-base font-medium mb-1">Hair type</label>
                                                            <select
                                                                id="hairTypeInput"
                                                                value={hairTypeValue}
                                                                onChange={(e) => {
                                                                    setHairTypeValue(e.target.value);
                                                                    setReplaceHairType(e.target.value !== (originalHairType || ''));
                                                                }}
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!hairTypeValue && !originalHairType ? 'text-gray-500' : ''}`}
                                                            >
                                                                <option value="" disabled={!!originalHairType}>Select one</option>
                                                                {hairTypeOptions.map(option => (
                                                                    <option key={option} value={option}>{option.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</option>
                                                                ))}
                                                            </select>
                                                            {replaceHairType && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replaceHairType}
                                                                        onChange={(e) => setReplaceHairType(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{originalHairType ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'hair_colour' && (
                                                        <React.Fragment>
                                                            <label htmlFor="hairColourInput" className="block text-gray-700 text-base font-medium mb-1">Hair colour</label>
                                                            <select
                                                                id="hairColourInput"
                                                                value={hairColourValue}
                                                                onChange={(e) => {
                                                                    setHairColourValue(e.target.value);
                                                                    setReplaceHairColour(e.target.value !== (originalHairColour || ''));
                                                                }}
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!hairColourValue && !originalHairColour ? 'text-gray-500' : ''}`}
                                                            >
                                                                <option value="" disabled={!!originalHairColour}>Select one</option>
                                                                {hairColourOptions.map(option => (
                                                                    <option key={option} value={option}>{option.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</option>
                                                                ))}
                                                            </select>
                                                            {replaceHairColour && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replaceHairColour}
                                                                        onChange={(e) => setReplaceHairColour(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{originalHairColour ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'tattoos' && (
                                                        <React.Fragment>
                                                            <label htmlFor="tattoosInput" className="block text-gray-700 text-base font-medium mb-1">Tattoos</label>
                                                            <select
                                                                id="tattoosInput"
                                                                value={tattoosValue}
                                                                onChange={(e) => {
                                                                    setTattoosValue(e.target.value);
                                                                    setReplaceTattoos(e.target.value !== (originalTattoos || ''));
                                                                }}
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!tattoosValue && !originalTattoos ? 'text-gray-500' : ''}`}
                                                            >
                                                                <option value="" disabled={!!originalTattoos}>Select one</option>
                                                                {tattoosOptions.map(option => (
                                                                    <option key={option} value={option}>{option.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</option>
                                                                ))}
                                                            </select>
                                                            {replaceTattoos && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replaceTattoos}
                                                                        onChange={(e) => setReplaceTattoos(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{originalTattoos ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'piercings' && (
                                                        <React.Fragment>
                                                            <label htmlFor="piercingsInput" className="block text-gray-700 text-base font-medium mb-1">Piercings</label>
                                                            <select
                                                                id="piercingsInput"
                                                                value={piercingsValue}
                                                                onChange={(e) => {
                                                                    setPiercingsValue(e.target.value);
                                                                    setReplacePiercings(e.target.value !== (originalPiercings || ''));
                                                                }}
                                                                className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] ${!piercingsValue && !originalPiercings ? 'text-gray-500' : ''}`}
                                                            >
                                                                <option value="" disabled={!!originalPiercings}>Select one</option>
                                                                {piercingsOptions.map(option => (
                                                                    <option key={option} value={option}>{option.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</option>
                                                                ))}
                                                            </select>
                                                            {replacePiercings && (
                                                                <label className="flex items-center text-gray-700 mt-3">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={replacePiercings}
                                                                        onChange={(e) => setReplacePiercings(e.target.checked)}
                                                                        className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                    />
                                                                    <span className="ml-2">{originalPiercings ? "Replace what's on my profile" : "Save to my creator profile"}</span>
                                                                </label>
                                                            )}
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'filmingLocation' && (
                                                        <React.Fragment>
                                                            {/* Required chips reminder */}
                                                            {q.description && (
                                                                <p className="text-gray-700 mb-2">
                                                                    This brief requires a <span className="font-bold">{q.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</span> setup
                                                                </p>
                                                            )}
                                                            <p className="text-gray-700 mb-4">On your profile, you have listed having access to <span className="font-bold">{currentUser.filming_location.join(', ').replace(/_/g, ' ')}</span></p>

                                                            <p className="text-gray-700 mb-4">Please confirm you have access to the following spaces:</p>

                                                            <div className="flex items-center space-x-6 mb-4 ml-8">
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name={`${q.id}-accessDecision`}
                                                                        value="yes"
                                                                        checked={filmingLocationResponses[q.name]?.accessDecision === 'yes'}
                                                                        onChange={() => handleFilmingLocationUserResponse(q.name, 'accessDecision', 'yes')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">Yes, still accessible</span>
                                                                </label>
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name={`${q.id}-accessDecision`}
                                                                        value="no"
                                                                        checked={filmingLocationResponses[q.name]?.accessDecision === 'no'}
                                                                        onChange={() => handleFilmingLocationUserResponse(q.name, 'accessDecision', 'no')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">No, not currently accessible</span>
                                                                </label>
                                                            </div>
                                                        </React.Fragment>
                                                    )}

                                                    {q.type === 'coStars' && (
                                                        <React.Fragment>
                                                            {/* Required chips reminder */}
                                                            {q.description && (
                                                                <p className="text-gray-700 mb-2">
                                                                    This brief requires a <span className="font-bold">{q.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</span> setup
                                                                </p>
                                                            )}
                                                            <p className="text-gray-700 mb-4">On your profile, you have listed having access to <span className="font-bold">{currentUser.co_stars.join(', ').replace(/_/g, ' ')}</span></p>

                                                            <p className="text-gray-700 mb-4">Please confirm you have access to the following co-stars:</p>

                                                            <div className="flex items-center space-x-6 mb-4 ml-8">
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name={`${q.id}-availabilityDecision`}
                                                                        value="yes"
                                                                        checked={coStarResponses[q.name]?.availabilityDecision === 'yes'}
                                                                        onChange={() => handleCoStarUserResponse(q.name, 'availabilityDecision', 'yes')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">Yes, available to co-star</span>
                                                                </label>
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name={`${q.id}-availabilityDecision`}
                                                                        value="no"
                                                                        checked={coStarResponses[q.name]?.availabilityDecision === 'no'}
                                                                        onChange={() => handleCoStarUserResponse(q.name, 'availabilityDecision', 'no')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">No, not available to co-star</span>
                                                                </label>
                                                            </div>
                                                        </React.Fragment>
                                                    )}
                                                </div>
                                            ))}
                                        </React.Fragment>
                                    ) : (
                                        <p className="text-center text-lg text-gray-600 mt-8">No questions have been selected for this survey yet. Please check the Internal/Community UX.</p>
                                    )}
                                </div>
                            )}
                            <button
                                type="button"
                                className="w-full py-3 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700 transition duration-300 ease-in-out shadow-lg transform hover:scale-105 mt-8"
                            >
                                Submit my application
                            </button>
                        </React.Fragment>
                    </div>
                </div>
            );
        };


        // Main App Component
        const App = () => {
            const [view, setView] = React.useState('backstage'); // 'backstage' or 'frontstage'
            const [users, setUsers] = React.useState([]);
            const [surveyConfig, setSurveyConfig] = React.useState({
                projectTitle: '',
                projectCode: '',
                briefSummary: '', // Initialize new state for brief summary
                selectedQuestions: [], // Now stores objects { id: string, note: string, details: any }
                bespokeQuestions: [] // Initialize bespoke questions in survey config
            });

            // Initialize users once when the app starts, as there's no Firebase
            React.useEffect(() => {
                setUsers(generateFictionalUsers());
            }, []);

            return (
                <AppContext.Provider value={{ users, surveyConfig, setSurveyConfig }}>
                    {view === 'backstage' ? (
                        <Backstage setView={setView} />
                    ) : (
                        <Frontstage setView={setView} />
                    )}
                </AppContext.Provider>
            );
        };

        // Render the React application
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
